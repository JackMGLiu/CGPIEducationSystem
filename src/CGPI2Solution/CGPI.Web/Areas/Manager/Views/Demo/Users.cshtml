
@{
    ViewData["Title"] = "测试用户管理";
}
<div class="kit-table">
    <form class="layui-form" lay-filter="kit-search-form">
        <div class="kit-table-header">
            <div class="kit-search-btns">
                <a href="javascript:;" data-action="add" class="layui-btn layui-btn-small"><i class="layui-icon">&#xe608;</i> 新增</a>
                <a href="javascript:;" data-action="del-bulk" class="layui-btn layui-btn-small layui-btn-danger"><i class="layui-icon">&#xe640;</i> 批量删除</a>
            </div>
            <div class="kit-search-inputs">
                <div class="kit-search-keyword">
                    <input type="text" class="layui-input" name="keyword" placeholder="搜索关键字.." />
                    <button lay-submit lay-filter="search"><i class="layui-icon">&#xe615;</i></button>
                </div>
                <div class="kit-search-more" id="kit-search-more">更多筛选<i class="layui-icon">&#xe61a;</i></div>
            </div>
        </div>
        <div class="kit-search-mored layui-anim layui-anim-upbit">
            <div class="kit-search-body">
                <div class="layui-form-item">
                    <label class="layui-form-label">输入框</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" placeholder="请输入标题" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">验证手机</label>
                        <div class="layui-input-inline">
                            <input type="tel" name="phone" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">验证邮箱</label>
                        <div class="layui-input-inline">
                            <input type="text" name="email" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">范围</label>
                        <div class="layui-input-inline" style="width: 100px;">
                            <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">
                        </div>
                        <div class="layui-form-mid">-</div>
                        <div class="layui-input-inline" style="width: 100px;">
                            <input type="text" name="price_max" placeholder="￥" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">单行选择框</label>
                    <div class="layui-input-block">
                        <select name="interest" lay-filter="aihao">
                            <option value=""></option>
                            <option value="0">写作</option>
                            <option value="1" selected="">阅读</option>
                            <option value="2">游戏</option>
                            <option value="3">音乐</option>
                            <option value="4">旅行</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="kit-search-footer">
                <button type="reset" class="layui-btn layui-btn-small layui-btn-primary kit-btn">重置</button>
                <button lay-submit lay-filter="search" class="layui-btn layui-btn-small kit-btn">确定</button>
            </div>
        </div>
    </form>
    <div class="kit-table-body">
        <table id="users" lay-filter="users"></table>
        <script type="text/html" id="barDemo">
            <a class="layui-btn layui-btn-mini" lay-event="detail">查看</a>
            <a class="layui-btn layui-btn-mini" lay-event="edit">编辑</a>
            <a class="layui-btn layui-btn-danger layui-btn-mini" lay-event="del">删除</a>
        </script>
    </div>
</div>
@section managerscripts{
    <script type="text/html" id="edit-tpl">
        <div style="margin:10px">
            <form class="layui-form" action="" lay-filter="form-edit">
                <input type="hidden" name="id" value="{{d.user.id}}" />
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label label-required">用户名：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="Account" lay-verify="required" value="{{d.user.account}}" placeholder="请输入用户名" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label label-required">真实姓名：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="realname" lay-verify="required" value="{{d.user.realname}}" placeholder="请输入姓名" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label label-required">手机号码：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="MobilePhone" lay-verify="required|number|phone" value="{{d.user.mobile}}" placeholder="请输入手机号码" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">性别：</label>
                        <div class="layui-input-inline">
                            <select name="Gender" lay-verify="">
                                {{# var woman = d.user.gender === false?'selected':'';}} {{# var man = d.user.gender === true?'selected':'';}}
                                <option value="">请选择性别</option>
                                <option value="true" {{man}}>男</option>
                                <option value="false" {{woman}}>女</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">民族：</label>
                        <div class="layui-input-inline">
                            <select name="nation" lay-verify="">
                                <option value=""></option>
                                {{# layui.each(d.nations,function(index,item){ }}
                                {{# if(item.id===d.user.nation){}}
                                <option value="{{item.id}}" selected="selected">{{item.name}}</option>
                                {{#}else{}}
                                <option value="{{item.id}}">{{item.name}}</option>
                                {{#};}}
                                {{# }); }}
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">出生日期：</label>
                        <div class="layui-input-inline">
                            <input type="text" id="Birthday" name="Birthday" value="{{d.user.birth}}" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">身份证号：</label>
                    <div class="layui-input-block">
                        <input type="text" id="CardId" name="CardId" lay-verify="identity" value="{{d.user.cardid}}" placeholder="请输入身份证号码" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">联系地址：</label>
                    <div class="layui-input-block">
                        <textarea name="Address" placeholder="联系地址" class="layui-textarea">{{d.user.address}}</textarea>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">备注信息：</label>
                    <div class="layui-input-block">
                        <textarea name="Remark" placeholder="备注信息" class="layui-textarea">{{d.user.remark}}</textarea>
                    </div>
                </div>
                <div class="layui-form-item" style="display:none;">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="formEdit">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </script>


    <script>
        layui.use(['table', 'laydate'],
            function () {
                var table = layui.table,
                    $ = layui.jquery,
                    layer = layui.layer,
                    form = layui.form,
                    laytpl = layui.laytpl,
                    laydate = layui.laydate;

                var tableIns = table.render({
                    elem: '#users',
                    height: 'full-50', //容器高度
                    url: 'table.json',
                    page: true,
                    id: 'tbusers',
                    cols: [
                        [
                            {
                                checkbox: true,
                                fixed: true
                            }, {
                                field: 'Id',
                                title: 'ID',
                                width: 80
                            }, {
                                field: 'Account',
                                title: '用户名',
                                width: 80
                            },
                            {
                                field: 'EnCode',
                                title: '工号',
                                width: 100
                            },
                            {
                                field: 'Gender',
                                title: '性别',
                                width: 80
                            }, {
                                field: 'MobilePhone',
                                title: '手机号码',
                                width: 120
                            }, {
                                field: 'CreateTime',
                                title: '添加时间',
                                width: 135
                            }, {
                                field: 'CreateUser',
                                title: '操作人',
                                width: 135
                                //sort: true
                            }, {
                                fixed: 'right',
                                title: '操作',
                                width: 150,
                                align: 'center',
                                toolbar: '#barDemo'
                            }
                        ]
                    ],
                    done: function (res, curr, count) {
                        //如果是异步请求数据方式，res即为你接口返回的信息。
                        //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                        // console.log(res);
                        // //得到当前页码
                        // console.log(curr);
                        // //得到数据总量
                        // console.log(count);
                    },
                    loading: true,
                    //method: 'post'
                });

                form.render(null, 'kit-search-form');
                $('#kit-search-more').on('click',
                    function () {
                        $('.kit-search-mored').toggle();
                    });

                var editIndex;
                //提交
                form.on('submit(formEdit)', function (form) {
                    //console.log(data);
                    //layer.msg('formEdit');
                    //editIndex && layer.close(editIndex); //关闭弹出层

                    $.formSubmit({
                        winindex: editIndex,
                        showMsg: false,
                        url: "/demo/addusers",
                        data: form.field
                    });
                    return false;
                });

                $('.kit-search-btns').children('a').off('click').on('click',
                    function () {
                        var $that = $(this),
                            action = $that.data('action');
                        switch (action) {
                            case 'add':
                                var d = {
                                    user: {
                                        id: 0,
                                        account: '',
                                        realname: '',
                                        mobile: '13753133423',
                                        gender: null,
                                        cardid: '140107198508032212',
                                        nation: -1,
                                        birth:'',
                                        address: '',
                                        remark: ''
                                    },
                                    nations: staticData.nations,
                                    classifies: staticData.classifies
                                };
                                //渲染
                                laytpl($('#edit-tpl').html()).render(d,
                                    function (html) {
                                        layer.open({
                                            type: 1,
                                            title: '用户信息表单',
                                            content: html,
                                            area: ['80%', '85%'],
                                            btn: ['提交', '重置', '取消'],
                                            yes: function (index, layero) {
                                                editIndex = index;
                                                $('form[lay-filter="form-edit"]').find('button[lay-submit]').click();
                                            },
                                            btn2: function (index, layero) {
                                                $('form[lay-filter="form-edit"]').find('button[type="reset"]').click();
                                                return false;
                                            },
                                            success: function () {
                                                laydate.render({
                                                    elem: '#Birthday'
                                                });
                                                form.render(null, 'form-edit');
                                            }
                                        });
                                    });
                                break;
                        }
                    });
            });

        var staticData = {
            citys: [
                {
                    id: 0,
                    name: '北京'
                }, {
                    id: 1,
                    name: '广州'
                }, {
                    id: 2,
                    name: '深圳'
                }, {
                    id: 3,
                    name: '杭州'
                }
            ],
            classifies: [
                {
                    id: 0,
                    name: '词人'
                }, {
                    id: 1,
                    name: '诗人'
                }, {
                    id: 2,
                    name: '作家'
                }, {
                    id: 3,
                    name: '酱油'
                }
            ],
            nations: [
                {
                    id: 0,
                    name: '汉族'
                },
                {
                    id: 2,
                    name: '回族'
                },
                {
                    id: 3,
                    name: '壮族'
                },
                {
                    id: 4,
                    name: '蒙古族'
                }
            ]
        };
    </script>
}
